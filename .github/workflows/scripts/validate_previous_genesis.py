import argparse
import os
import toml
from typing import Dict

PREVIOUS_NET_ADDRESSES = {'65.108.199.210:26656', '103.149.46.12:26656', '95.216.144.135:26656', '162.19.169.12:26656', '65.108.75.107:58656', '65.109.139.182:26656', '173.212.223.233:36656', '23.88.5.169:26656', '38.242.145.197:26656', '65.109.72.14:26656', '31.220.83.2:26656', '103.180.28.210:26656', '65.108.225.158:26656', '128.140.3.224:26656', '77.120.115.145:26656', '88.171.165.179:26656', '194.163.139.165:26656', '213.239.216.252:26656', '65.108.75.32:26656', '65.21.229.248:26656', '65.108.132.239:26656', '167.86.68.204:26656', '159.69.209.122:26656', '92.100.157.81:26656', '164.68.102.10:26656', '65.109.31.55:26656', '144.76.99.100:26656', '198.74.112.63:26656', '206.116.159.111:26656', '135.181.116.109:26656', '5.9.70.180:26656', '47.242.192.140:26656', '149.28.31.173:26656', '31.7.196.10:26656', '162.55.6.163:26656', '49.12.129.137:26656', '185.155.97.74:26656', '37.120.171.213:14656', '65.109.6.35:26656', '65.108.101.19:20156', '69.197.6.24:26656', '195.14.6.169:26656', '213.239.207.175:26656', '65.108.78.29:26656', '5.9.61.237:26656', '23.88.74.54:26656', '86.48.3.133:26656', '138.197.160.81:26656', '65.109.106.214:26656', '65.109.25.104:26656', '167.71.55.25:26656', '92.97.155.229:26676', '66.135.14.41:26656', '178.63.105.179:26656', '188.166.202.55:26656', '185.185.82.62:26656', '18.202.229.149:26656', '65.108.229.93:26656', '43.201.126.213:26656', '173.212.200.210:26656', '93.115.25.19:26656', '146.19.24.52:26656', '65.108.201.189:26656', '162.55.0.160:26656', '51.89.43.174:26656', '77.241.194.155:26656', '65.21.77.175:26656', '135.181.216.54:3000', '176.9.7.136:26656', '51.38.53.103:26656', '38.242.251.1:26656', '65.108.207.160:26656', '65.108.108.52:26656', '5.181.190.157:26656', '43.163.230.17:26656', '127.0.0.1:26656', '85.10.198.169:26656', '185.172.191.12:26656', '185.10.140.93:26656', '103.50.32.17:26656', '194.163.148.115:26656', '65.108.76.60:26656', '194.163.132.91:26656', '65.109.122.90:26656', '144.217.79.221:26656', '158.220.97.60:26656', '70.59.12.70:26656', '95.216.154.254:26656', '13.250.9.214:26656', '149.102.138.221:26656', '185.218.126.117:26656', '65.109.92.83:26656', '139.59.25.39:26656', '173.249.7.88:26656', '62.183.54.219:26656', '185.197.251.177:26656', '178.63.15.35:26656', '157.90.183.32:26656', '138.201.85.176:26656', '194.34.232.124:26656', '65.21.133.114:26256', '176.9.245.155:26656', '185.188.249.209:26656', '80.64.208.172:26656', '95.217.57.232:36656', '141.95.204.81:26656', '136.243.148.154:26656', '181.214.147.81:26656', '148.113.8.233:26656', '88.208.57.200:26656', '99.230.250.213:26656', '144.76.72.166:26656', '62.33.73.29:26656', '159.203.12.165:26656', '172.105.173.225:26656', '116.202.117.229:26656', '65.109.90.162:26656', '65.108.232.227:26656', '65.109.85.170:26656', '162.55.84.47:26656', '88.99.95.81:26656', '148.251.82.189:26656', '65.109.92.13:26656', '65.108.72.253:26656', '91.144.171.205:26656', '65.109.226.62:26656', '193.34.212.26:26656', '95.216.4.183:26656', '212.51.129.74:26656', '65.109.108.152:29056', '142.132.152.46:26656', '88.198.52.46:26656', '78.46.103.15:26656', '65.21.163.229:26656', '167.235.251.16:26656', '143.110.172.17:26656', '217.209.26.198:26656', '144.91.87.99:26656', '65.109.116.22:26656', '222.106.187.14:54306', '51.91.105.170:26656', '162.55.1.2:26656', '65.21.0.131:26656', '82.208.21.89:26656', '38.242.140.193:26656', '88.198.52.89:26656', '65.109.93.152:26656', '65.108.131.189:26656', '178.170.42.198:26656', '65.21.28.230:26656', '185.132.132.100:26656', '65.108.201.15:28856', '65.108.131.190:26656', '152.32.192.85:26656', '136.243.103.53:26656', '148.251.91.185:26656', '109.123.244.56:26656', '165.227.167.124:26656', '65.108.78.41:26656', '65.21.40.6:26656', '164.92.74.199:26656', '142.132.135.125:24656', '37.120.245.74:26656', '23.88.66.239:26656', '147.182.171.232:26656', '144.76.182.73:26656', '65.21.121.208:26656', '54.36.166.159:26656', '185.209.223.64:26656', '144.76.28.163:26656', '65.21.139.150:26656', '63.32.210.222:26656', '109.205.182.127:26656', '162.55.99.181:26656', '88.99.161.228:26656', '65.21.224.248:26656', '157.90.176.184:36656', '34.159.27.16:26656', '103.69.193.38:26656', '159.69.72.220:26656', '89.58.45.204:26656', '65.108.124.121:26656', '65.109.69.163:26156', '188.165.229.79:26656', '143.244.196.53:26656', '95.216.65.177:26656', '125.253.92.223:26656', '176.9.80.61:26656', '176.9.2.2:26656', '167.235.27.69:26656', '88.208.242.218:26656', '80.190.129.50:26656', '5.75.167.124:26656', '65.108.43.113:26656'}

def is_valid_update(data: Dict) -> bool:
    validator_alias = list(data['validator'].keys())[0]
    validator_data = data['validator'][validator_alias]

    if not validator_data['net_address'] in PREVIOUS_NET_ADDRESSES:
        return False
    return True


def main(args):
    dir_name = args.folder
    filenames = os.listdir(dir_name)
    is_correct = True
    total_pregenesis_files = 0

    for filename in filenames:
        if filename.endswith(".toml"):
            total_pregenesis_files += 1
            data = toml.load(os.path.join(dir_name, filename))
            if not is_valid_update(data):
                print("Invalid update pregenesis file: " + filename)
                is_correct = False

    print("Checked {} files.".format(total_pregenesis_files))
    if is_correct:
        print("All update pregenesis files are valid")
        exit(0)
    else:
        print("Not all update pregenesis files are valid")
        exit(1)



if __name__ == '__main__':
    parser = argparse.ArgumentParser(prog='NamadaValidatePregenesisUpdate', description='Validates all update pregenesis tomls')
    parser.add_argument('--folder', help='The name of the directory to validate.', default="namada-mainnet")
    args = parser.parse_args()

    main(args)


